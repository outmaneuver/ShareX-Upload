<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <link rel="stylesheet" href="/styles/style.css">
</head>
<body>
    <h2>User Dashboard</h2>
    
    <div class="statistics-box">
        <h3>Statistics</h3>
        <div id="statistics"></div>
    </div>

    <div class="uploads">
        <h3>Your Uploads</h3>
        <ul id="imagesList"></ul>
    </div>

    <div class="settings">
        <h3>Settings</h3>
        <form id="settingsForm">
            <label for="file_name_length">File Name Length:</label>
            <input type="number" id="file_name_length" name="file_name_length" min="1" max="50">
            
            <label for="upload_password">Upload Password:</label>
            <input type="password" id="upload_password" name="upload_password">
            
            <label for="hide_user_info">Hide User Info:</label>
            <input type="checkbox" id="hide_user_info" name="hide_user_info">
            
            <button type="submit">Save Settings</button>
        </form>
    </div>

    <script>
        // Fetch user images
        fetch('/dashboard/images')
            .then(response => response.json())
            .then(images => {
                const imagesList = document.getElementById('imagesList');
                images.forEach(image => {
                    const li = document.createElement('li');
                    li.innerHTML = `
                        ${image.filename}
                        <button onclick="deleteImage('${image._id}')">Delete</button>
                    `;
                    imagesList.appendChild(li);
                });
            });

        // Fetch statistics
        fetch('/dashboard/statistics')
            .then(response => response.json())
            .then(stats => {
                const statisticsDiv = document.getElementById('statistics');
                statisticsDiv.innerHTML = Object.entries(stats)
                    .map(([key, value]) => `<p>${key}: ${value}</p>`)
                    .join('');
            });

        // Handle settings form
        document.getElementById('settingsForm').onsubmit = async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            await fetch('/dashboard/update_settings', {
                method: 'POST',
                body: JSON.stringify(Object.fromEntries(formData)),
                headers: {'Content-Type': 'application/json'}
            });
            alert('Settings updated successfully');
        };

        function deleteImage(id) {
            if (confirm('Are you sure you want to delete this image?')) {
                fetch('/dashboard/delete_image', {
                    method: 'POST',
                    body: JSON.stringify({ imageId: id }),
                    headers: {'Content-Type': 'application/json'}
                })
                .then(() => location.reload());
            }
        }
    </script>
</body>
</html>